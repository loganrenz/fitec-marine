import{d as D,u as E,r as n,o as F,c as u,a as _,b as e,t as A,i as W,e as i,_ as T,f as B,g as $,h as H,j as V,k as j,l as S,n as N,m as K,T as O,p as q}from"./index-DCXSyeEi.js";const G={key:0,class:"modal-content"},J={key:1,class:"modal-content max-h-screen overflow-hidden"},Q={class:"relative bg-black"},X={class:"p-4 space-y-2"},Y=["disabled"],Z=["disabled"],ee={key:2,class:"modal-content p-8"},te={key:3,class:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-red-50 text-red-700 px-6 py-3 rounded-xl shadow-lg max-w-md mx-4"},ae={class:"text-sm font-medium"},oe=D({__name:"EmotionCapture",emits:["close","emotion-detected"],setup(P,{emit:k}){const h=k,g=W("emotionDetection")||E(),c=n(!0),f=n(!1),a=n(null),r=n(null),y=n(null),v=n(null),s=n(!1),o=n("");async function w(){try{c.value=!1,o.value="",v.value=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:1280,height:720},audio:!1}),a.value&&(a.value.srcObject=v.value,f.value=!0)}catch(t){console.error("Webcam access error:",t),o.value="Unable to access camera. Please check permissions and try uploading an image instead."}}function p(){v.value&&(v.value.getTracks().forEach(t=>t.stop()),v.value=null),f.value=!1}async function C(){if(!(!a.value||!r.value)){s.value=!0,o.value="";try{const t=r.value,l=a.value;t.width=l.videoWidth,t.height=l.videoHeight;const x=t.getContext("2d");x&&x.drawImage(l,0,0),p();const m=new Image;m.onload=async()=>{await R(m)},m.src=t.toDataURL()}catch(t){console.error("Capture error:",t),o.value="Failed to capture photo. Please try again.",s.value=!1}}}function b(){c.value=!1,y.value?.click()}async function d(t){const x=t.target.files?.[0];if(x){s.value=!0,o.value="";try{const m=new FileReader;m.onload=async L=>{const z=new Image;z.onload=async()=>{await R(z)},z.src=L.target?.result},m.readAsDataURL(x)}catch(m){console.error("File read error:",m),o.value="Failed to read image file.",s.value=!1}}}async function R(t){try{await g.detectFromImage(t)?h("emotion-detected"):(o.value=g.error.value||"No face detected. Please try another image.",s.value=!1)}catch(l){console.error("Analysis error:",l),o.value="Failed to analyze image. Please try again.",s.value=!1}}function I(){p(),h("close")}function U(t){t.target===t.currentTarget&&I()}return F(()=>{p()}),(t,l)=>(i(),u("div",{class:"modal-overlay",onClick:U,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title"},[c.value?(i(),u("div",G,[l[0]||(l[0]=e("div",{class:"p-4 text-center font-semibold text-gray-600 text-sm border-b border-gray-200"},[e("h2",{id:"modal-title"},"Choose Image Source")],-1)),e("div",{class:"p-2"},[e("button",{class:"w-full py-4 text-lg text-blue-500 hover:bg-gray-50 transition-colors border-b border-gray-100",onClick:w,"aria-label":"Take photo with camera"}," üì∑ Take Photo "),e("button",{class:"w-full py-4 text-lg text-blue-500 hover:bg-gray-50 transition-colors border-b border-gray-100",onClick:b,"aria-label":"Choose from library"}," üñºÔ∏è Choose from Library "),e("button",{class:"w-full py-4 text-lg text-red-500 hover:bg-gray-50 transition-colors font-semibold mt-2 rounded-xl",onClick:I,"aria-label":"Cancel"}," Cancel ")])])):f.value?(i(),u("div",J,[e("div",Q,[e("video",{ref_key:"videoRef",ref:a,autoplay:"",playsinline:"",class:"w-full","aria-label":"Webcam video feed"},null,512),e("canvas",{ref_key:"canvasRef",ref:r,class:"hidden"},null,512)]),e("div",X,[e("button",{class:"w-full py-3 bg-red-500 text-white font-semibold rounded-xl hover:bg-red-600 transition-colors",onClick:C,disabled:s.value,"aria-label":"Capture photo"},A(s.value?"Analyzing...":"Capture Photo"),9,Y),e("button",{class:"w-full py-3 bg-gray-500 text-white font-semibold rounded-xl hover:bg-gray-600 transition-colors",onClick:p,disabled:s.value,"aria-label":"Stop camera"}," Stop Camera ",8,Z)])])):s.value?(i(),u("div",ee,[...l[1]||(l[1]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-4 border-indigo-500 mx-auto mb-4"}),e("p",{class:"text-lg font-semibold text-gray-700"},"Analyzing your emotion..."),e("p",{class:"text-sm text-gray-500 mt-2"},"This may take a moment")],-1)])])):_("",!0),o.value?(i(),u("div",te,[e("p",ae,A(o.value),1)])):_("",!0),e("input",{ref_key:"fileInputRef",ref:y,type:"file",accept:"image/*",class:"hidden",onChange:d,"aria-label":"File input for image selection"},null,544)]))}}),se=T(oe,[["__scopeId","data-v-ff614792"]]),le={class:"container-card"},ne=["disabled"],ie={key:0,class:"mb-4"},re=D({__name:"HomeView",setup(P){const k=q(),h=B(),M=$(),g=E(),c=H(),f=n(!1),a=n("Initializing AI models..."),r=n("info"),y=n(!1),v=V(()=>h.modelsLoaded);j(async()=>{if(!h.modelsLoaded&&(a.value="Loading AI models... This may take a moment.",!await g.initialize())){a.value="Error loading AI models. Please refresh the page.",r.value="error";return}(c.isReady.value||await c.initialize())&&(y.value=!0),a.value="Ready! Click the button to get started.",r.value="success"}),F(()=>{g.cleanup()});function s(){f.value=!0}function o(){f.value=!1}async function w(){o(),await k.push({name:"results"})}async function p(){await c.authorize()?(a.value="Apple Music authorized successfully!",r.value="success"):(a.value=c.error.value||"Authorization failed",r.value="error")}async function C(){await c.unauthorize(),a.value="Apple Music disconnected",r.value="info"}return(b,d)=>(i(),u("div",le,[d[1]||(d[1]=e("header",{class:"text-center mb-6"},[e("h1",{class:"text-4xl font-bold text-gray-800 mb-2"}," üéµ Emotion Music "),e("p",{class:"text-gray-600 text-sm"}," Let your face choose the perfect playlist ")],-1)),e("div",{class:N(`status-${r.value}`),role:"status","aria-live":"polite"},A(a.value),3),e("button",{class:"btn-primary mb-4",disabled:!v.value,onClick:s,"aria-label":"Select image to analyze emotion"}," Select Image ",8,ne),y.value?(i(),u("div",ie,[K(M).isAuthorized?(i(),u("button",{key:1,class:"btn-secondary w-full",onClick:C,"aria-label":"Unauthorize Apple Music"}," Unauthorize Apple Music ")):(i(),u("button",{key:0,class:"btn-secondary w-full",onClick:p,"aria-label":"Authorize Apple Music"}," Authorize Apple Music ")),d[0]||(d[0]=e("p",{class:"text-xs text-gray-500 text-center mt-2"}," Connect to play songs directly ",-1))])):_("",!0),d[2]||(d[2]=e("a",{href:"../../index.html",class:"block text-center mt-8 text-indigo-600 hover:text-indigo-800 font-medium transition-colors"}," ‚Üê Back to Home ",-1)),(i(),S(O,{to:"body"},[f.value?(i(),S(se,{key:0,onClose:o,onEmotionDetected:w})):_("",!0)]))]))}}),ue=T(re,[["__scopeId","data-v-03ecde34"]]);export{ue as default};
